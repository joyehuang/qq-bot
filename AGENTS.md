# Repository Guidelines

## Project Structure & Module Organization
- `src/index.ts` runs the NapCat OneBot handler; keep new handlers/utilities nearby or in `src/config`.
- `src/generated/prisma/client` is generated by Prisma; do not edit by hand.
- `prisma/schema.prisma` defines the SQLite schema; `prisma/migrations` stores generated migrations.
- `napcat/config` holds NapCat connection config; avoid committing secrets.
- `docker-compose.yml` and `Dockerfile` cover container runs; `COMMANDS.md` tracks user-facing commands and must stay current.

## Build, Test, and Development Commands
- `npm install` — install dependencies.
- `npm run start` — run the bot locally via `ts-node` against the `.env` config.
- `npm run build` — type-check and emit compiled JS to `dist/`.
- `npx prisma migrate dev` — create/apply a migration after editing `prisma/schema.prisma`; pairs with `npx prisma generate` to refresh `src/generated/prisma/client`.
- `docker compose up -d --build` — rebuild and run the service stack for deployment verification.

## Coding Style & Naming Conventions
- TypeScript with `strict` mode; prefer 2-space indentation, single quotes, and explicit return types on exports.
- Reuse centralized records for achievements, AI styles, and classifications instead of new literals.
- Avoid hard-coding IDs or tokens; read from `.env` (e.g., `DATABASE_URL`, `ADMIN_QQ`, `BOT_QQ`, AI keys).
- Update `COMMANDS.md` and `README.md` when commands or onboarding steps change.

## Testing Guidelines
- No automated suite yet; when adding tests, keep them as `*.test.ts` beside sources and wire `npm test` to Vitest/Jest.
- Until then, run `npm run start` and exercise commands through a local NapCat session; note any manual steps in PRs when flows are hard to automate (e.g., QR login).

## Commit & Pull Request Guidelines
- Use Conventional Commits: `type(scope): description` (e.g., `feat(checkin): add streak rewards`); single line only.
- After a feature slice, commit, push, and refresh deployment with `docker compose up -d --build`.
- PRs should note scope, migrations (`prisma migrate dev --name <label>`), env changes, and screenshots/logs for user-visible flows.

## Security & Configuration Tips
- Do not commit `.env`, database files, or NapCat credential artifacts; rely on local overrides and `.gitignore`.
- Rotate AI and GitHub tokens regularly; prefer environment variables over in-code defaults, and log only non-sensitive metadata when debugging.
