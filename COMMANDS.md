# QQ 打卡机器人指令文档

## 基础命令

所有命令需要在群里 @机器人 后发送，私聊可直接发送。

**@ 方式支持：**
- QQ 原生 @（从成员列表选择）
- 手动输入 `@JoyeBot`、`@joye`、`@打卡` 等

### 打卡相关

| 命令 | 说明 | 示例 |
|------|------|------|
| `我想打卡` / `注册` / `加入打卡` | 新人注册，获取使用说明 | `我想打卡` |
| `打卡 [时长] [内容]` | 记录打卡 | `打卡 30分钟 学习TypeScript` |
| `@某人 打卡 [时长] [内容]` | 为他人打卡 | `@小明 打卡 1小时 帮忙学习` |
| `打卡 贷款 [时长] [内容]` | 贷款打卡（预支未来的打卡） | `打卡 贷款 1小时 学习` |
| `@某人 打卡 贷款 [时长] [内容]` | 为他人贷款打卡 | `@小明 打卡 贷款 30分钟 先欠着` |
| `打卡记录` / `我的打卡` | 查看打卡统计（含 AI 分析） | `打卡记录` |
| `查看打卡` / `ta的打卡` | 查看指定用户的打卡记录 | `查看打卡 @某人` 或 `查看打卡 123456789` |
| `周报` / `本周报告` / `我的周报` | 查看本周打卡周报（含 AI 总结） | `周报` |
| `年度报告` / `年报` / `我的年报` | 查看年度报告（含 AI 深度分析） | `年报` |
| `负债` / `我的负债` / `欠款` / `查看负债` | 查看贷款负债情况 | `负债` |

**为他人打卡说明：**
- 在打卡指令前 @ 某人即可为他人打卡
- 打卡记录会记录在被 @ 的人身上
- 支持普通打卡和贷款打卡
- 为他人打卡时不会显示 AI 鼓励语

### 每日目标

| 命令 | 说明 | 示例 |
|------|------|------|
| `设置目标 [时长]` / `目标 [时长]` | 设置每日打卡目标 | `设置目标 2小时` |
| `设置目标 清除` | 清除每日目标 | `设置目标 清除` |

**目标功能：**
- 打卡时会显示目标进度条
- 达成目标时会有特别祝贺
- 目标最长可设置24小时

### AI 风格设置

| 命令 | 说明 | 示例 |
|------|------|------|
| `设置风格 [风格ID]` / `AI风格 [风格ID]` / `风格 [风格ID]` | 设置 AI 回复风格 | `设置风格 strict` |
| `风格列表` / `设置风格` / `AI风格` / `风格` | 查看所有可用风格 | `风格列表` |

**可用风格：**

| 风格ID | 风格名称 | 描述 |
|--------|----------|------|
| `encourage` | 温柔鼓励型 | 正能量满满，给予温暖的鼓励（默认） |
| `strict` | 严厉激励型 | 严格要求，激发斗志 |
| `funny` | 搞笑吐槽型 | 轻松幽默，带点调侃 |
| `professional` | 专业分析型 | 客观理性，数据导向 |
| `ridicule` | 中二羞辱型 | 恶趣味激将，适合重口味 |

**AI 风格影响的功能：**
- ✅ 打卡时的鼓励语（每次打卡都会根据风格生成个性化鼓励）
- ✅ 统计分析（查看打卡记录时的 AI 小结）
- ✅ 周报总结（查看周报时的 AI 总结）

### AI 智能分类

**自动分类系统（v1.2.0+）：**

机器人会 **自动分析** 每次打卡内容，无需手动添加标签！

**分类体系：**

📚 **学习**
- 💻 计算机（算法、前端、后端、数据库、系统设计、DevOps、计算机基础）
- 🌍 英语（听力、口语、阅读、写作、词汇、语法、考试）
- 📖 其他学习

💼 **工作**（项目开发、文档、会议）

🏃 **运动**（跑步、健身、球类等）

🎮 **娱乐**（游戏、追剧、社交）

📱 **其他**

**分类展示：**
- ✅ 打卡记录：显示每条打卡的分类标签
- ✅ 打卡统计：本周各分类时长占比 + 进度条
- ✅ 周报：学习分布图表 + 子分类 TOP 2

**智能识别示例：**
```
打卡 2小时 刷 leetcode  → 【学习·计算机·算法】
打卡 1小时 背雅思单词   → 【学习·英语·词汇】
打卡 30分钟 跑步       → 【运动】
打卡 1小时 写项目代码   → 【工作】
```

**技术说明：**
- 🤖 结合关键词匹配 + AI 语义理解
- ⚡ 异步分类，不影响打卡响应速度
- 📊 数据越多，分类统计越精准

### 排行榜

| 命令 | 说明 | 示例 |
|------|------|------|
| `今日排行` / `今日榜` / `日榜` | 今日打卡排行榜 | `今日排行` |
| `本周排行` / `周排行` / `周榜` | 本周打卡排行榜 | `周榜` |
| `总排行` / `排行榜` / `总榜` | 总打卡排行榜 | `排行榜` |
| `群统计` / `群数据` / `今日统计` | 查看群整体打卡数据 | `群统计` |

### 成就系统

| 命令 | 说明 | 示例 |
|------|------|------|
| `成就` / `我的成就` / `成就列表` | 查看已解锁和未解锁的成就 | `成就` |

**可解锁成就：**
| 成就 | 名称 | 条件 |
|------|------|------|
| 🎯 | 初来乍到 | 完成首次打卡 |
| 🔥 | 小试牛刀 | 连续打卡3天 |
| 💪 | 持之以恒 | 连续打卡7天 |
| 🏆 | 打卡狂人 | 连续打卡30天 |
| ⭐ | 崭露头角 | 累计打卡1小时 |
| 🌟 | 初具规模 | 累计打卡10小时 |
| 💎 | 百炼成钢 | 累计打卡100小时 |
| ✨ | 信用良好 | 还清所有贷款负债 |
| 🌅 | 早起鸟儿 | 早上6-8点打卡 |
| 🌙 | 夜猫子 | 晚上22-24点打卡 |

**连续打卡：**
- 每次正常打卡会自动更新连续打卡天数
- 打卡成功后会显示当前连续天数
- 如果断签会重新从1天开始计算

### 群头衔系统

**自动头衔（机器人需要是群管理员）：**

| 头衔 | 获得条件 | 保持时间 |
|------|----------|----------|
| 今日第一🥇 | 当天打卡时长第一名 | 每次打卡后更新 |
| 周榜第一🥇 | 本周打卡时长第一名 | 每天 0 点更新 |
| 周榜第二🥈 | 本周打卡时长第二名 | 每天 0 点更新 |
| 周榜第三🥉 | 本周打卡时长第三名 | 每天 0 点更新 |
| 打卡老赖💸 | 贷款负债超过 5 小时 | 还清负债后自动清除 |
| 🎯初来乍到 | 解锁对应成就时 | 24 小时后自动清除 |
| 🔥小试牛刀 | 解锁对应成就时 | 24 小时后自动清除 |
| （其他成就）| 解锁对应成就时 | 24 小时后自动清除 |

**头衔说明：**
- 头衔会自动设置，无需手动操作
- 多个头衔时，最后设置的会覆盖前面的
- 需要在 `.env` 中配置 `TITLE_GROUP_ID` 启用（默认和督促群相同）
- 可通过 `DEBT_THRESHOLD` 配置老赖阈值（默认 300 分钟 = 5 小时）

**支持的时长格式：**
- 分钟：`30分钟`、`45m`、`30分`、`60min`
- 小时：`1小时`、`2h`、`1.5时`、`3hr`
- 复合：`1小时30分钟`、`2h30m`
- 天数：`1天`、`2d`
- 秒数：`3600秒`、`1800s`（自动转换为分钟）
- 纯数字：`30`（默认为分钟）

**贷款打卡机制：**
- 贷款打卡会产生"负债"，需要通过正常打卡来"还款"
- 正常打卡的时长会自动抵消贷款负债
- 打卡记录中会显示当前负债总额
- 连续贷款会收到调侃提醒
- 还清所有贷款会有特别祝贺

### GitHub 相关

| 命令 | 说明 | 示例 |
|------|------|------|
| `github` / `GitHub` / `代码` / `提交` | 查看今日 GitHub 提交数量 | `github` |

根据提交数量会有不同的回复：
- 0 次：提醒去写代码
- 1-4 次：继续加油
- 5-9 次：效率不错
- 10+ 次：代码狂魔

### 互动功能

| 命令 | 说明 | 示例 |
|------|------|------|
| `建议` / `反馈` / `新功能` | 提交功能建议 | `建议 希望添加排行榜功能` |
| `帮助` / `help` | 查看帮助信息 | `帮助` |
| `ping` | 测试机器人 | `ping` |

### 自我介绍（模糊匹配）

机器人会自动识别以下类型的问题：

**身份询问：**
- `你是谁`、`你叫什么`、`介绍一下`、`自我介绍`、`是什么机器人` 等

**能力询问：**
- `你能做什么`、`有什么功能`、`怎么用`、`如何使用` 等

**打招呼：**
- `你好`、`在吗`、`hello`、`hi`、`早上好` 等

---

## 管理员命令

只有管理员可以使用以下命令。

### 开关机控制（模糊匹配）

**关机命令：**
- `闭嘴`、`关机`、`不准说话`、`安静`、`别说了`、`休息`、`下班`、`关闭`、`停止`、`别吵`

**开机命令：**
- `开机`、`说话`、`醒醒`、`起来`、`上班`、`开启`、`启动`、`工作`、`唤醒`、`醒来`

### 管理员查询

| 命令 | 说明 |
|------|------|
| `管理员列表` / `管理列表` | 查看当前所有管理员 |

---

## 超级管理员命令

只有超级管理员（环境变量 `ADMIN_QQ` 配置的 QQ 号）可以使用。

| 命令 | 说明 | 示例 |
|------|------|------|
| `测试模式` / `测试` / `test` | 切换测试模式（再次发送切换回正常） | `测试模式` |
| `添加管理` / `添加管理员` | 添加新管理员 | `添加管理 123456789` |
| `删除管理` / `删除管理员` / `移除管理` / `移除管理员` | 删除管理员 | `删除管理 123456789` |
| `督促` / `测试督促` | 手动触发打卡督促（测试用） | `督促` |
| `测试年报` | 测试年度报告功能，私聊发送 | `测试年报` |
| `发布更新` / `版本更新` / `更新通知` | 发送版本更新通知到群 | `发布更新 新增AI分析功能` |

**测试模式说明：**
- 🧪 测试模式下，所有打卡记录**不会保存**到数据库
- ✅ 仍然会执行 AI 分类，可用于测试分类准确性
- ✅ 打卡回复会显示分类结果和【测试模式】标记
- ⚠️ 测试模式对所有用户生效（不仅是超级管理员）
- 🔄 再次发送 `测试模式` 指令即可切换回正常模式

**注意：** 超级管理员不能被删除。

---

## 权限说明

- **普通用户**：可使用基础命令
- **管理员**：可使用基础命令 + 管理员命令
- **超级管理员**：可使用所有命令，可管理其他管理员

---

## 自动功能

### 年度报告自动推送（v1.3.0+）

机器人会在每年指定时间自动为所有活跃用户生成并发送年度报告。

- 默认时间：每年 12 月 31 日 20:00（北京时间）
- 报告通过私聊发送给每位用户
- 可通过环境变量自定义推送时间

**年度报告包含：**
- 📈 基础统计（累计打卡、次数、天数、日均时长）
- 🔥 连续打卡（当前连续、历史最长）
- ✨ 高光时刻（单日最长）
- 📚 分类分布（可视化进度条）
- 🏆 年度成就
- 🤖 AI 深度分析（基于所有打卡记录的个性化总结和新年展望）

### 打卡督促

机器人会在每天指定时间检查超级管理员是否已打卡，如未打卡则在群里 @提醒。

- 默认时间：北京时间 19:00
- 可通过环境变量自定义时间和时区

### 断签提醒（v1.2.1+）

**双重提醒机制：** 只对连续打卡 **≥5天** 的用户生效

1. **断签警告（避免断签）**
   - 每天晚上 21:00（可配置）
   - 检查连续打卡 ≥5天 但今天还没打卡的用户
   - @提醒避免断签
   - 示例消息：`@用户 你已经连续打卡 7 天了！今天还没打卡哦，再不打卡连续记录就要断啦！💔`

2. **断签调侃（已经断了）**
   - 每天早上 9:00（可配置）
   - 检查连续打卡 ≥5天 但昨天断签的用户
   - @调侃已经断签的用户
   - 示例消息：`@用户 啊哦～ 7 天的连续打卡说没就没了！昨天竟然忘记打卡了？😱`

**特点：**
- ✅ 只对连续打卡5天以上的用户生效（避免打扰新手）
- ✅ 双重保险：先提醒避免断签，真断了再调侃
- ✅ 多条随机消息，有趣不重复
- ✅ 自动间隔1秒发送，避免刷屏
- ✅ 时间和时区可配置

---

## 配置说明

在 `.env` 文件中配置：

```env
# 机器人QQ号（用于精确检测@，推荐配置）
BOT_QQ="机器人QQ号"

# 超级管理员QQ号
ADMIN_QQ="你的QQ号"

# 打卡督促配置
REMINDER_GROUP_ID="群号"           # 督促消息发送的群
REMINDER_HOUR="19"                 # 督促时间（小时，24小时制）
REMINDER_MINUTE="0"                # 督促时间（分钟）
REMINDER_TIMEZONE="Asia/Shanghai"  # 时区（默认北京时间）

# 断签提醒配置
STREAK_WARNING_HOUR="21"           # 断签警告时间（小时，默认21点）
STREAK_WARNING_MINUTE="0"         # 断签警告时间（分钟，默认0分）
STREAK_TAUNT_HOUR="9"              # 断签调侃时间（小时，默认9点）
STREAK_TAUNT_MINUTE="0"            # 断签调侃时间（分钟，默认0分）

# 年度报告配置
YEARLY_REPORT_MONTH="12"           # 推送月份（1-12，默认12）
YEARLY_REPORT_DAY="31"             # 推送日期（默认31日）
YEARLY_REPORT_HOUR="20"            # 推送时间（小时，默认20点）
YEARLY_REPORT_MINUTE="0"           # 推送时间（分钟，默认0分）

# GitHub 配置
GITHUB_USERNAME="你的GitHub用户名"
# GitHub Token（可选，用于访问私有仓库）
# 生成地址: https://github.com/settings/tokens
# 需要 repo 权限
GITHUB_TOKEN="ghp_xxxx"

# AI 配置（用于个性化分析和周报）
AI_API_KEY="your-siliconflow-api-key"
AI_MODEL="Qwen/Qwen2.5-7B-Instruct"  # 可选，默认使用此模型

# 群头衔系统配置（机器人需要是群管理员）
TITLE_GROUP_ID="群号"          # 启用头衔功能的群号（默认和督促群相同）
DEBT_THRESHOLD="300"           # 打卡老赖阈值（分钟，默认300=5小时）
```

**注意事项：**
- 单次打卡时长最多支持 7 天（10080 分钟）
- 配置 `BOT_QQ` 可以避免机器人误响应其他人的 @ 消息
- 群头衔功能需要机器人是群管理员才能生效
